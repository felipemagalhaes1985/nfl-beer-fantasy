<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NFL Beer Fantasy - Evolução da Pontuação</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <!-- CDN para Chart.js - Biblioteca de gráficos JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <header>
        <div class="container">
            <h1><a href="{{ url_for('home') }}">NFL Beer Fantasy</a></h1>
            <nav>
                <ul>
                    <li><a href="{{ url_for('home') }}">Home</a></li>
                    <li><a href="{{ url_for('regras') }}">Regras</a></li>
                    <li><a href="{{ url_for('evolucao_pontuacao_page') }}">Evolução Pontuação</a></li> {# Link para esta página #}
                    {% if current_user.is_authenticated %}
                        <li><a href="{{ url_for('meu_perfil') }}">Meu Perfil</a></li>
                        <li><a href="{{ url_for('palpitar') }}">Palpitar</a></li>
                        {% if current_user.is_admin %}
                            <li><a href="{{ url_for('admin_dashboard') }}">Painel Administrativo</a></li>
                        {% endif %}
                        <li><a href="{{ url_for('logout') }}">Sair</a></li>
                    {% else %}
                        <li><a href="{{ url_for('login') }}">Entrar</a></li>
                        <li><a href="{{ url_for('registro') }}">Registrar</a></li>
                    {% endif %}
                </ul>
            </nav>
        </div>
    </header>

    <main class="container">
        <h2>Evolução da Pontuação (F1-like)</h2>

        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <ul class="flashes">
                {% for category, message in messages %}
                    <li class="{{ category }}">{{ message }}</li>
                {% endfor %}
                </ul>
            {% endif %}
        {% endwith %}

        <div style="width: 100%; max-width: 900px; margin: 20px auto;">
            <canvas id="scoreEvolutionChart"></canvas>
        </div>

        <script>
            document.addEventListener('DOMContentLoaded', function() {
                fetch('/api/evolucao_pontuacao_data')
                    .then(response => response.json())
                    .then(data => {
                        const ctx = document.getElementById('scoreEvolutionChart').getContext('2d');
                        new Chart(ctx, {
                            type: 'line',
                            data: {
                                labels: data.labels,
                                datasets: data.datasets
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: true,
                                plugins: {
                                    title: {
                                        display: true,
                                        text: 'Evolução Cumulativa dos Pontos F1-like por Semana'
                                    },
                                    tooltip: {
                                        mode: 'index',
                                        intersect: false
                                    }
                                },
                                hover: {
                                    mode: 'nearest',
                                    intersect: true
                                },
                                scales: {
                                    x: {
                                        display: true,
                                        title: {
                                            display: true,
                                            text: 'Semana'
                                        }
                                    },
                                    y: {
                                        display: true,
                                        title: {
                                            display: true,
                                            text: 'Pontos F1-like Cumulativos'
                                        },
                                        beginAtZero: true
                                    }
                                }
                            }
                        });
                    })
                    .catch(error => {
                        console.error('Erro ao buscar dados do gráfico:', error);
                        const chartContainer = document.getElementById('scoreEvolutionChart').parentNode;
                        chartContainer.innerHTML = '<p style="color: red; text-align: center;">Erro ao carregar o gráfico. Tente novamente mais tarde ou verifique o console para detalhes.</p>';
                    });
            });
        </script>
    </main>

    <footer>
        <div class="container">
            <p>&copy; 2025 NFL Beer Fantasy. Todos os direitos reservados.</p>
        </div>
    </footer>
</body>
</html>