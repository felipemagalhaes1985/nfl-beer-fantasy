<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NFL Beer Fantasy - Meu Perfil</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <header>
        <div class="container">
            <h1><a href="{{ url_for('home') }}">NFL Beer Fantasy</a></h1>
            <nav>
                <ul>
                    <li><a href="{{ url_for('home') }}">Home</a></li>
                    {% if current_user.is_authenticated %}
                        <li><a href="{{ url_for('meu_perfil') }}">Meu Perfil</a></li>
                        <li><a href="{{ url_for('palpitar') }}">Palpitar</a></li>
                        {% if current_user.is_admin %}
                            <li><a href="{{ url_for('admin_dashboard') }}">Painel Administrativo</a></li>
                        {% endif %}
                        <li><a href="{{ url_for('logout') }}">Sair</a></li>
                    {% else %}
                        <li><a href="{{ url_for('login') }}">Entrar</a></li>
                        <li><a href="{{ url_for('registro') }}">Registrar</a></li>
                    {% endif %}
                </ul>
            </nav>
        </div>
    </header>

    <main class="container">
        <h2>Perfil de {{ current_user.nome }}</h2>
        <p><strong>Pontuação Total:</strong> {{ total_pontos_f1 }} pts</p> {# Removido default(0) pois o COALESCE já garante 0 #}

        <h3>Meus Palpites</h3>
        {% if palpites %}
        <table>
            <thead>
                <tr>
                    <th>Jogo</th>
                    <th>Meu Palpite (Vencedor)</th>
                    <th>Meu Palpite (Placar)</th>
                    <th>Resultado do Jogo (Vencedor)</th>
                    <th>Placar Final Real</th>
                    <th>Pontuação Recebida</th>
                </tr>
            </thead>
            <tbody>
                {% for palpite in palpites %}
                <tr>
                    <td>
                        {{ palpite.jogo.time1 }} vs. {{ palpite.jogo.time2 }}
                        ({{ palpite.jogo.data_hora.strftime('%d/%m/%Y %H:%M') }})
                    </td>
                    <td>
                        {{ palpite.escolha.replace('_', ' ').title() }}
                    </td>
                    <td>
                        {% if palpite.placar_time1 is not none and palpite.placar_time2 is not none %}
                            {{ palpite.placar_time1 }} - {{ palpite.placar_time2 }}
                        {% else %}
                            N/A
                        {% endif %}
                    </td>
                    <td>
                        {% if palpite.jogo.resultado %}
                            {{ palpite.jogo.resultado.replace('_', ' ').title() }}
                        {% else %}
                            Ainda não definido
                        {% endif %}
                    </td>
                    <td>
                        {% if palpite.jogo.placar_time1_final is not none and palpite.jogo.placar_time2_final is not none %}
                            {{ palpite.jogo.placar_time1_final }} - {{ palpite.jogo.placar_time2_final }}
                        {% else %}
                            Aguardando...
                        {% endif %}
                    </td>
                    <td>{{ palpite.pontuacao_recebida }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <p>Você ainda não registrou nenhum palpite.</p>
        {% endif %}
    </main>

    <footer>
        <div class="container">
            <p>&copy; 2025 NFL Beer Fantasy. Todos os direitos reservados.</p>
        </div>
    </footer>
</body>
</html>